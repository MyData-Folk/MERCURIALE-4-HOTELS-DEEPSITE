<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>MERCURIO – Comparateur & Commande</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            background: linear-gradient(135deg, #f0f4ff 0%, #e6f0ff 100%);
            min-height: 100vh;
        }

        .gradient-text-header {
            color: white;
        }

        /* Styles des boutons */
        .btn-primary {
            background: linear-gradient(135deg, #4f46e5, #2563eb);
            transition: all 0.2s;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(0);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            transition: all 0.2s;
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);
        }

        /* Style de la barre de défilement personnalisée */
        .custom-scrollbar::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #c7d2fe;
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #a5b4fc;
        }

        /* Surlignage pour le terme recherché */
        .search-highlight {
            background-color: #e0e7ff;
            padding: 0 2px;
            border-radius: 2px;
            font-weight: 600;
        }
        
        /* Animation pour le bouton Ajouter tout */
        @keyframes pulse-gentle {
            0% { transform: scale(1); }
            50% { transform: scale(1.02); }
            100% { transform: scale(1); }
        }

        .btn-primary:hover {
            animation: pulse-gentle 2s infinite;
        }

        /* Style pour les boutons désactivés */
        .btn-disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            cursor: not-allowed;
        }

        /* Style pour le statut "Déjà ajouté" */
        .status-added {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        /* Style pour le bouton Nouvelle Commande */
        .btn-reset {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            transition: all 0.2s;
        }
        
        .btn-reset:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        /* Mode sélection */
        .mode-selector {
            display: flex;
            border-radius: 0.5rem;
            overflow: hidden;
            margin-bottom: 1.5rem;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .mode-btn {
            flex: 1;
            padding: 0.75rem 1rem;
            text-align: center;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            background-color: #e0e7ff;
            color: #4f46e5;
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #4f46e5, #2563eb);
            color: white;
        }

        .mode-btn:first-child {
            border-top-left-radius: 0.5rem;
            border-bottom-left-radius: 0.5rem;
        }

        .mode-btn:last-child {
            border-top-right-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }

        /* Comparaison de prix */
        .price-comparison {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .price-card {
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            transition: all 0.2s;
            background-color: white;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }

        .price-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .price-card-header {
            font-weight: 600;
            color: #4f46e5;
            margin-bottom: 0.5rem;
        }

        .price-card-value {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1e293b;
        }
    </style>
</head>
<body class="antialiased">
    <div class="min-h-screen flex flex-col items-center justify-center py-8 px-4">
        <div class="w-full max-w-7xl bg-white rounded-xl shadow-xl">
            <!-- Header -->
            <div class="bg-gradient-to-r from-indigo-600 to-blue-600 p-6 text-white rounded-t-xl">
                <div class="flex items-center justify-between">
                    <div>
                        <h1 class="text-3xl font-bold flex items-center">
                            <i class="fas fa-store-alt mr-3"></i>
                            <span class="gradient-text-header">MERCURIO</span>
                        </h1>
                        <p class="text-blue-100 mt-1">Comparez vos mercuriales, préparez et exportez votre commande fournisseur</p>
                    </div>
                    <div class="hidden md:block">
                        <div class="flex space-x-2">
                            <span class="bg-blue-500 text-xs px-3 py-1 rounded-full flex items-center"><i class="fas fa-database mr-1"></i><span>4 sources</span></span>
                            <span class="bg-blue-500 text-xs px-3 py-1 rounded-full flex items-center"><i class="fas fa-boxes mr-1"></i><span id="productCount">0 produits</span></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="p-6">
                <!-- Mode Selector -->
                <div class="mode-selector">
                    <div class="mode-btn active" data-mode="compare">
                        <i class="fas fa-chart-line mr-2"></i>Comparer les prix
                    </div>
                    <div class="mode-btn" data-mode="order">
                        <i class="fas fa-shopping-cart mr-2"></i>Préparer commande
                    </div>
                </div>

                <!-- Compare Mode -->
                <div id="compareMode">
                    <div class="mb-6">
                        <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                            <i class="fas fa-search mr-2 text-indigo-500"></i>Rechercher un produit
                        </h2>
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                <i class="fas fa-barcode text-gray-400"></i>
                            </div>
                            <input type="text" id="productCodeInput" placeholder="Entrez un code produit (ex: 12345) ou plusieurs codes séparés par un espace..." autocomplete="off" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>

                    <!-- Price Comparison Results -->
                    <div id="priceComparisonResults" class="hidden">
                        <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center">
                            <i class="fas fa-balance-scale mr-2 text-indigo-500"></i>Comparaison des prix
                        </h2>
                        <div id="priceComparisonCards" class="price-comparison"></div>
                        
                        <div class="mt-6">
                            <button id="addToComparisonListBtn" class="btn-secondary text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
                                <i class="fas fa-plus-circle mr-2"></i>Ajouter à la liste de comparaison
                            </button>
                        </div>
                    </div>

                    <!-- Comparison List -->
                    <div id="comparisonListSection" class="mt-8 hidden">
                        <div class="flex items-center justify-between mb-3">
                            <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                                <i class="fas fa-list-ul mr-2 text-indigo-500"></i>Liste de comparaison
                                <span id="comparisonCount" class="ml-2 bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-full">0</span>
                            </h2>
                            <div class="flex space-x-2">
                                <button id="exportComparisonCsvBtn" class="btn-primary text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
                                    <i class="fas fa-file-csv mr-2"></i>CSV
                                </button>
                                <button id="exportComparisonXlsxBtn" class="btn-primary text-white px-4 py-2 rounded-md text-sm font-medium flex items-center">
                                    <i class="fas fa-file-excel mr-2"></i>Excel
                                </button>
                            </div>
                        </div>
                        <div id="comparisonList" class="border border-gray-200 rounded-lg">
                            <p class="text-center text-gray-500 py-8 px-4">Aucun article ajouté à la liste de comparaison.</p>
                        </div>
                    </div>
                </div>

                <!-- Order Mode -->
                <div id="orderMode" class="hidden">
                    <!-- Search & Filter Section -->
                    <div class="mb-8">
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-4">
                            <div class="flex flex-wrap gap-3">
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="source" value="folkestone" checked class="h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500"><span class="ml-2 text-gray-700 font-medium">Folkestone</span>
                                </label>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="source" value="vendome" checked class="h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500"><span class="ml-2 text-gray-700 font-medium">Vendôme</span>
                                </label>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="source" value="washington" checked class="h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500"><span class="ml-2 text-gray-700 font-medium">Washington</span>
                                </label>
                                <label class="inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="source" value="lehavre" checked class="h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500">
                                    <span class="ml-2 text-gray-700 font-medium">Le Havre</span>
                                </label>
                            </div>
                            
                            <div class="flex flex-col sm:flex-row gap-4">
                                <div class="relative">
                                    <button id="columnSelectorBtn" class="w-full sm:w-auto flex items-center justify-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                                        <i class="fas fa-columns mr-2"></i>
                                        Afficher les colonnes
                                        <i class="fas fa-chevron-down ml-2 -mr-1 h-5 w-5"></i>
                                    </button>
                                    <div id="columnSelectorDropdown" class="hidden origin-top-right absolute right-0 mt-2 w-64 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none z-20">
                                        <div class="p-2" id="columnCheckboxes">
                                            <p class="text-sm text-gray-500 text-center py-2">Chargement...</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="relative w-full sm:w-auto">
                                    <select id="searchField" class="block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 py-2 pl-3 pr-10 text-base bg-gray-50">
                                        <option value="all" selected>Tous les champs</option>
                                        <option value="Libellé produit">Libellé produit</option>
                                        <option value="Marque">Marque</option>
                                        <option value="Code Produit">Code Produit</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="relative">
                            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"><i class="fas fa-search text-gray-400"></i></div>
                            <input type="text" id="searchInput" placeholder="Rechercher un produit, ou plusieurs codes produits séparés par un espace..." autocomplete="off" class="block w-full pl-10 pr-3 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                        </div>
                    </div>

                    <!-- Search Results -->
                    <div class="mb-8">
                        <h2 class="text-lg font-semibold text-gray-800 mb-3 flex items-center"><i class="fas fa-search mr-2 text-indigo-500"></i>Résultats de recherche</h2>
                        <div id="searchResults" class="border border-gray-200 rounded-lg">
                            <p class="text-center text-gray-500 py-8 px-4">Commencez à taper pour rechercher...</p>
                        </div>
                    </div>

                    <!-- Order Section -->
                    <div>
                        <div class="flex items-center justify-between mb-3">
                            <h2 class="text-lg font-semibold text-gray-800 flex items-center"><i class="fas fa-shopping-cart mr-2 text-indigo-500"></i>Ma commande<span id="orderCount" class="ml-2 bg-indigo-100 text-indigo-800 text-xs font-medium px-2.5 py-0.5 rounded-full">0</span></h2>
                            <div class="flex space-x-2">
                                <button id="newOrderBtn" class="btn-reset text-white px-4 py-2 rounded-md text-sm font-medium flex items-center"><i class="fas fa-trash-alt mr-2"></i>Nouvelle Commande</button>
                                <button id="downloadCsvBtn" disabled class="btn-primary text-white px-4 py-2 rounded-md text-sm font-medium flex items-center disabled:opacity-50 disabled:cursor-not-allowed"><i class="fas fa-file-csv mr-2"></i>CSV</button>
                                <button id="downloadXlsxBtn" disabled class="btn-primary text-white px-4 py-2 rounded-md text-sm font-medium flex items-center disabled:opacity-50 disabled:cursor-not-allowed"><i class="fas fa-file-excel mr-2"></i>Excel</button>
                            </div>
                        </div>
                        <div id="orderList" class="border border-gray-200 rounded-lg">
                            <p class="text-center text-gray-500 py-8 px-4">Aucun article ajouté.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer -->
            <div class="bg-gray-50 px-6 py-4 border-t border-gray-200 rounded-b-xl">
                <div class="flex flex-col md:flex-row md:items-center md:justify-between text-sm text-gray-500">
                    <div class="flex items-center justify-center md:justify-start mb-2 md:mb-0"><i class="fas fa-info-circle mr-2"></i><span>© 2025 MERCURIO – MyData-Folk</span></div>
                    <div class="flex items-center justify-center md:justify-end space-x-4">
                        <a href="CONVERTISSEUR/index.html" target="_blank" class="hover:text-indigo-600"><i class="fas fa-sync-alt mr-1"></i>Convertisseur JSON</a>
                        <a href="#" id="settingsBtn" class="hover:text-indigo-600"><i class="fas fa-cog mr-1"></i>Paramètres</a>
                        <a href="#" id="contactBtn" class="hover:text-indigo-600"><i class="fas fa-envelope mr-1"></i>Contact</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modale Paramètres -->
    <div id="settingsModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3">
                <p class="text-2xl font-bold">Paramètres</p>
                <div class="cursor-pointer z-50 modal-close">
                    <i class="fas fa-times text-gray-500"></i>
                </div>
            </div>
            <div class="text-sm">
                <p class="mb-4">Gérez les préférences de votre application ici.</p>
                <button id="resetAppBtn" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded">
                    <i class="fas fa-trash-alt mr-2"></i>Réinitialiser la commande et les préférences
                </button>
                 <p class="text-xs text-gray-500 mt-2">Attention : Cette action est irréversible. Elle videra votre commande en cours et réinitialisera l'affichage des colonnes par défaut.</p>
            </div>
        </div>
    </div>

    <!-- Modale Contact -->
    <div id="contactModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full flex items-center justify-center z-50">
        <div class="relative mx-auto p-5 border w-full max-w-md shadow-lg rounded-md bg-white">
            <div class="flex justify-between items-center pb-3">
                <p class="text-2xl font-bold">Contact</p>
                <div class="cursor-pointer z-50 modal-close">
                    <i class="fas fa-times text-gray-500"></i>
                </div>
            </div>
            <div class="text-sm">
                <p class="mb-4">Pour toute question ou assistance, veuillez nous contacter à l'adresse suivante :</p>
                <div class="text-center p-3 bg-gray-100 rounded-md">
                    <a href="mailto:mydata.folkestone@gmail.com" class="text-indigo-600 font-semibold hover:underline">
                        <i class="fas fa-envelope mr-2"></i>mydata.folkestone@gmail.com
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const modeBtns = document.querySelectorAll('.mode-btn');
            const compareMode = document.getElementById('compareMode');
            const orderMode = document.getElementById('orderMode');
            const productCodeInput = document.getElementById('productCodeInput');
            const priceComparisonResults = document.getElementById('priceComparisonResults');
            const priceComparisonCards = document.getElementById('priceComparisonCards');
            const addToComparisonListBtn = document.getElementById('addToComparisonListBtn');
            const comparisonListSection = document.getElementById('comparisonListSection');
            const comparisonList = document.getElementById('comparisonList');
            const comparisonCount = document.getElementById('comparisonCount');
            const exportComparisonCsvBtn = document.getElementById('exportComparisonCsvBtn');
            const exportComparisonXlsxBtn = document.getElementById('exportComparisonXlsxBtn');
            
            // Existing DOM elements (from order mode)
            const searchInput = document.getElementById('searchInput');
            const searchField = document.getElementById('searchField');
            const sourceCheckboxes = document.querySelectorAll('input[name="source"]');
            const searchResultsContainer = document.getElementById('searchResults');
            const orderListContainer = document.getElementById('orderList');
            const downloadCsvBtn = document.getElementById('downloadCsvBtn');
            const downloadXlsxBtn = document.getElementById('downloadXlsxBtn');
            const orderCountElement = document.getElementById('orderCount');
            const productCountElement = document.getElementById('productCount');
            const columnSelectorBtn = document.getElementById('columnSelectorBtn');
            const columnSelectorDropdown = document.getElementById('columnSelectorDropdown');
            const columnCheckboxesContainer = document.getElementById('columnCheckboxes');
            const newOrderBtn = document.getElementById('newOrderBtn');
            
            // Modal Elements
            const settingsBtn = document.getElementById('settingsBtn');
            const contactBtn = document.getElementById('contactBtn');
            const settingsModal = document.getElementById('settingsModal');
            const contactModal = document.getElementById('contactModal');
            const closeModalBtns = document.querySelectorAll('.modal-close');
            const resetAppBtn = document.getElementById('resetAppBtn');

            // State
            let dataFolkestone = [], dataVendome = [], dataWashington = [], dataLeHavre = [];
            let currentData = [], orderList = [], lastSearchResults = [];
            let allHeaders = [], visibleColumns = [];
            let comparisonListData = [];
            let currentProductCode = null;
            let currentProductDetails = null;

            // --- LOCALSTORAGE ---
            function loadStateFromLocalStorage() {
                const savedOrder = localStorage.getItem('mercurialeOrder');
                const savedColumns = localStorage.getItem('mercurialeColumns');
                const savedComparison = localStorage.getItem('mercurialeComparison');
                
                orderList = savedOrder ? JSON.parse(savedOrder) : [];
                visibleColumns = savedColumns ? JSON.parse(savedColumns) : ['Libellé produit', 'Marque', 'Prix'];
                comparisonListData = savedComparison ? JSON.parse(savedComparison) : [];
            }
            
            function saveOrderToLocalStorage() {
                localStorage.setItem('mercurialeOrder', JSON.stringify(orderList));
            }

            function saveColumnsToLocalStorage() {
                localStorage.setItem('mercurialeColumns', JSON.stringify(visibleColumns));
            }
            
            function saveComparisonToLocalStorage() {
                localStorage.setItem('mercurialeComparison', JSON.stringify(comparisonListData));
            }
            
            // --- MODE SWITCHING ---
            modeBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    modeBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    
                    const mode = btn.dataset.mode;
                    if (mode === 'compare') {
                        compareMode.classList.remove('hidden');
                        orderMode.classList.add('hidden');
                    } else {
                        compareMode.classList.add('hidden');
                        orderMode.classList.remove('hidden');
                    }
                });
            });

            // --- INITIALISATION ---
            loadStateFromLocalStorage();
            initializeModals();

            Promise.all([
                fetch('data/mercuriale-folkestone.json').then(r => r.json()),
                fetch('data/mercuriale-vendome.json').then(r => r.json()),
                fetch('data/mercuriale-washington.json').then(r => r.json()),
                fetch('data/mercuriale-lehavre.json').then(r => r.json())
            ])
            .then(([folkestone, vendome, washington, lehavre]) => {
                dataFolkestone = folkestone.map(x => ({...x, _source: 'Folkestone'}));
                dataVendome = vendome.map(x => ({...x, _source: 'Vendôme'}));
                dataWashington = washington.map(x => ({...x, _source: 'Washington'}));
                dataLeHavre = lehavre.map(x => ({...x, _source: 'Le Havre'}));
                
                if (dataFolkestone.length > 0) {
                    allHeaders = Object.keys(dataFolkestone[0]).filter(h => h !== '_source');
                    populateColumnSelector();
                }
                
                updateCurrentData();
                updateProductCount();
                renderOrderList();
                renderComparisonList();
                
                // Initialisation des écouteurs d'événements pour la recherche
                initializeEventListeners();
            })
            .catch(error => {
                console.error("Erreur de chargement des fichiers JSON:", error);
                searchResultsContainer.innerHTML = `<div class="bg-red-50 border-l-4 border-red-400 p-4"><p class="text-sm text-red-700">Erreur : Impossible de charger les données.</p></div>`;
            });

            // --- INITIALISATION DES ÉCOUTEURS D'ÉVÉNEMENTS ---
            function initializeEventListeners() {
                // Recherche dans le mode commande
                searchInput.addEventListener('input', performSearch);
                searchField.addEventListener('change', performSearch);
                
                // Filtres par source
                sourceCheckboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        updateCurrentData();
                        updateProductCount();
                        performSearch();
                    });
                });
                
                // Sélecteur de colonnes
                columnSelectorBtn.addEventListener('click', toggleColumnSelector);
                
                // Bouton nouvelle commande
                newOrderBtn.addEventListener('click', () => {
                    if (confirm("Êtes-vous sûr de vouloir créer une nouvelle commande ? Votre commande actuelle sera perdue.")) {
                        orderList = [];
                        saveOrderToLocalStorage();
                        renderOrderList();
                        showNotification('Nouvelle commande créée', 'success');
                    }
                });
                
                // Boutons d'export
                downloadCsvBtn.addEventListener('click', downloadOrderAsCSV);
                downloadXlsxBtn.addEventListener('click', downloadOrderAsXLSX);
            }
            
            function toggleColumnSelector() {
                const isHidden = columnSelectorDropdown.classList.contains('hidden');
                if (isHidden) {
                    columnSelectorDropdown.classList.remove('hidden');
                    document.addEventListener('click', closeColumnSelectorOnClickOutside);
                } else {
                    columnSelectorDropdown.classList.add('hidden');
                    document.removeEventListener('click', closeColumnSelectorOnClickOutside);
                }
            }
            
            function closeColumnSelectorOnClickOutside(e) {
                if (!columnSelectorBtn.contains(e.target) && !columnSelectorDropdown.contains(e.target)) {
                    columnSelectorDropdown.classList.add('hidden');
                    document.removeEventListener('click', closeColumnSelectorOnClickOutside);
                }
            }

            // --- COMPARE MODE FUNCTIONS ---
            productCodeInput.addEventListener('input', (e) => {
                const code = e.target.value.trim();
                if (!code) {
                    priceComparisonResults.classList.add('hidden');
                    return;
                }
                
                currentProductCode = code;
                findProductByCode(code);
            });
            
            function findProductByCode(code) {
                const allData = [...dataFolkestone, ...dataVendome, ...dataWashington, ...dataLeHavre];
                const codes = code.includes(' ') ? code.split(' ').filter(c => c.trim()) : [code];
                
                if (codes.length > 1) {
                    // Traitement des multiples codes
                    priceComparisonCards.innerHTML = '';
                    let hasResults = false;
                    
                    codes.forEach(currentCode => {
                        const products = allData.filter(p => String(p['Code Produit'] ?? '').trim() === currentCode);
                        if (products.length > 0) {
                            hasResults = true;
                            // Créer un groupe pour ce code produit
                            priceComparisonCards.innerHTML += `
                                <div class="col-span-full mb-4">
                                    <h3 class="font-semibold text-lg text-indigo-700 mb-2">${products[0]['Libellé produit'] || 'Produit inconnu'}</h3>
                                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            `;
                            
                            // Afficher les prix pour chaque source
                            ['Folkestone', 'Vendôme', 'Washington', 'Le Havre'].forEach(source => {
                                const product = products.find(p => p._source === source);
                                const price = product ? parsePriceAsFloat(product.Prix) : 0;
                                const priceFormatted = product ? formatPriceFromFloat(price) : '-';
                                
                                priceComparisonCards.innerHTML += `
                                    <div class="price-card">
                                        <div class="price-card-header">${source}</div>
                                        <div class="text-xs text-gray-500 mb-1">${currentCode}</div>
                                        <div class="price-card-value">${priceFormatted}</div>
                                    </div>
                                `;
                            });
                            
                            priceComparisonCards.innerHTML += `</div></div>`;
                        }
                    });
                    
                    if (hasResults) {
                        priceComparisonResults.classList.remove('hidden');
                        addToComparisonListBtn.disabled = false;
                        addToComparisonListBtn.innerHTML = '<i class="fas fa-plus-circle mr-2"></i>Ajouter les résultats à la liste';
                    } else {
                        priceComparisonResults.classList.add('hidden');
                    }
                    return;
                }
                
                // Traitement d'un seul code
                const products = allData.filter(p => String(p['Code Produit'] ?? '').trim() === code);
                if (products.length === 0) {
                    priceComparisonResults.classList.add('hidden');
                    return;
                }

                // Group by product name (first product's name)
                const productName = products[0]['Libellé produit'] || 'Produit inconnu';
                const productBrand = products[0]['Marque'] || 'Marque inconnue';
                
                // Store current product details
                currentProductDetails = {
                    code: code,
                    name: productName,
                    brand: productBrand,
                    prices: []
                };
                
                // Clear previous results
                priceComparisonCards.innerHTML = '';
                
                // Check all sources
                const sources = {
                    'Folkestone': dataFolkestone.find(p => p['Code Produit'] == code),
                    'Vendôme': dataVendome.find(p => p['Code Produit'] == code),
                    'Washington': dataWashington.find(p => p['Code Produit'] == code),
                    'Le Havre': dataLeHavre.find(p => p['Code Produit'] == code)
                };
                
                Object.entries(sources).forEach(([source, product]) => {
                    if (product) {
                        const price = parsePriceAsFloat(product.Prix);
                        const priceFormatted = formatPriceFromFloat(price);
                        
                        currentProductDetails.prices.push({
                            source: source,
                            price: price,
                            priceFormatted: priceFormatted
                        });
                        
                        priceComparisonCards.innerHTML += `
                            <div class="price-card">
                                <div class="price-card-header">${source}</div>
                                <div class="price-card-value">${priceFormatted}</div>
                            </div>
                        `;
                    }
                });
                
                priceComparisonResults.classList.remove('hidden');
                updateAddToComparisonButton();
            }

            function updateAddToComparisonButton() {
                if (!currentProductCode || !currentProductDetails) {
                    addToComparisonListBtn.disabled = true;
                    return;
                }
                
                // Check if product is already in comparison list
                const isAlreadyInList = comparisonListData.some(item => item.code === currentProductCode);
                addToComparisonListBtn.disabled = isAlreadyInList;
                
                if (isAlreadyInList) {
                    addToComparisonListBtn.innerHTML = '<i class="fas fa-check mr-2"></i>Déjà dans la liste';
                } else {
                    addToComparisonListBtn.innerHTML = '<i class="fas fa-plus-circle mr-2"></i>Ajouter à la liste de comparaison';
                }
            }

            addToComparisonListBtn.addEventListener('click', () => {
                if (!currentProductCode || !currentProductDetails) return;
                
                comparisonListData.push({
                    code: currentProductCode,
                    name: currentProductDetails.name,
                    brand: currentProductDetails.brand,
                    prices: currentProductDetails.prices
                });
                
                saveComparisonToLocalStorage();
                renderComparisonList();
                updateAddToComparisonButton();
                showNotification('Produit ajouté à la liste de comparaison', 'success');
            });

            function renderComparisonList() {
                if (comparisonListData.length === 0) {
                    comparisonListSection.classList.add('hidden');
                    comparisonList.innerHTML = '<p class="text-center text-gray-500 py-8 px-4">Aucun article ajouté à la liste de comparaison.</p>';
                    return;
                }
                
                comparisonListSection.classList.remove('hidden');
                comparisonCount.textContent = comparisonListData.length;
                
                let tableHTML = `
                    <div class="custom-scrollbar" style="max-height: 400px; overflow-y: auto;">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100 sticky top-0 z-10">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Code</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Produit</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Marque</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Folkestone</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Vendôme</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Washington</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Le Havre</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                `;
                
                comparisonListData.forEach((item, index) => {
                    const folkestonePrice = item.prices.find(p => p.source === 'Folkestone');
                    const vendomePrice = item.prices.find(p => p.source === 'Vendôme');
                    const washingtonPrice = item.prices.find(p => p.source === 'Washington');
                    const lehavrePrice = item.prices.find(p => p.source === 'Le Havre');
                    
                    tableHTML += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.code}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.name}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.brand}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${folkestonePrice ? folkestonePrice.priceFormatted : '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${vendomePrice ? vendomePrice.priceFormatted : '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${washingtonPrice ? washingtonPrice.priceFormatted : '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${lehavrePrice ? lehavrePrice.priceFormatted : '-'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <button class="text-red-600 hover:text-red-900 remove-from-comparison" data-index="${index}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                tableHTML += `</tbody></table></div>`;
                comparisonList.innerHTML = tableHTML;
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-from-comparison').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        comparisonListData.splice(index, 1);
                        saveComparisonToLocalStorage();
                        renderComparisonList();
                        updateAddToComparisonButton();
                        showNotification('Produit retiré de la liste de comparaison', 'success');
                    });
                });
            }

            // --- EXPORT FUNCTIONS ---
            exportComparisonCsvBtn.addEventListener('click', () => {
                exportComparisonList('csv');
            });
            
            exportComparisonXlsxBtn.addEventListener('click', () => {
                exportComparisonList('xlsx');
            });
            
            function exportComparisonList(format) {
                if (comparisonListData.length === 0) {
                    showNotification('La liste de comparaison est vide', 'error');
                    return;
                }
                
                const headers = ['Code', 'Produit', 'Marque', 'Folkestone', 'Vendôme', 'Washington', 'Le Havre'];
                const rows = comparisonListData.map(item => {
                    const folkestonePrice = item.prices.find(p => p.source === 'Folkestone');
                    const vendomePrice = item.prices.find(p => p.source === 'Vendôme');
                    const washingtonPrice = item.prices.find(p => p.source === 'Washington');
                    const lehavrePrice = item.prices.find(p => p.source === 'Le Havre');
                    
                    return [
                        item.code,
                        item.name,
                        item.brand,
                        folkestonePrice ? folkestonePrice.price : '',
                        vendomePrice ? vendomePrice.price : '',
                        washingtonPrice ? washingtonPrice.price : '',
                        lehavrePrice ? lehavrePrice.price : ''
                    ];
                });
                
                if (format === 'csv') {
                    downloadComparisonCsv([headers, ...rows]);
                } else {
                    downloadComparisonXlsx([headers, ...rows]);
                }
            }
            
            function downloadComparisonCsv(data) {
                const csvContent = data.map(row => 
                    row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(',')
                ).join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `comparaison_mercuriale_${new Date().toISOString().slice(0,10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            function downloadComparisonXlsx(data) {
                const ws = XLSX.utils.aoa_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Comparaison');
                XLSX.writeFile(wb, `comparaison_mercuriale_${new Date().toISOString().slice(0,10)}.xlsx`);
            }

            // --- ORDER MODE FUNCTIONS ---
            function updateCurrentData() {
                currentData = [];
                if (document.querySelector('input[name="source"][value="folkestone"]').checked) {
                    currentData = currentData.concat(dataFolkestone);
                }
                if (document.querySelector('input[name="source"][value="vendome"]').checked) {
                    currentData = currentData.concat(dataVendome);
                }
                if (document.querySelector('input[name="source"][value="washington"]').checked) {
                    currentData = currentData.concat(dataWashington);
                }
                if (document.querySelector('input[name="source"][value="lehavre"]').checked) {
                    currentData = currentData.concat(dataLeHavre);
                }
            }

            function updateProductCount() {
                const count = currentData.length;
                productCountElement.textContent = `${count.toLocaleString()} produits`;
            }

            function performSearch() {
                const searchTerm = searchInput.value.trim();
                const searchFieldValue = searchField.value;
                
                if (!searchTerm) {
                    searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 py-8 px-4">Commencez à taper pour rechercher...</p>';
                    lastSearchResults = [];
                    return;
                }
                
                // Check if search term contains multiple product codes
                if (searchTerm.includes(' ')) {
                    const codes = searchTerm.split(' ').filter(c => c.trim());
                    if (codes.length > 1) {
                        // Search by multiple codes
                        const results = [];
                        codes.forEach(code => {
                            const codeResults = currentData.filter(product => {
                                return String(product['Code Produit'] ?? '').trim() === code;
                            });
                            results.push(...codeResults);
                        });
                        
                        lastSearchResults = results;
                        renderSearchResults(results);
                        return;
                    }
                }
                
                // Regular search
                const results = currentData.filter(product => {
                    if (searchFieldValue === 'all') {
                        return Object.values(product).some(value => 
                            String(value).toLowerCase().includes(searchTerm.toLowerCase())
                        );
                    } else {
                        const fieldValue = product[searchFieldValue];
                        return fieldValue && String(fieldValue).toLowerCase().includes(searchTerm.toLowerCase());
                    }
                });
                
                lastSearchResults = results;
                renderSearchResults(results);
            }

            function renderSearchResults(results) {
                if (results.length === 0) {
                    searchResultsContainer.innerHTML = '<p class="text-center text-gray-500 py-8 px-4">Aucun résultat trouvé.</p>';
                    return;
                }
                
                let tableHTML = `
                    <div class="custom-scrollbar" style="max-height: 400px; overflow-y: auto;">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100 sticky top-0 z-10">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Source</th>
                                    ${visibleColumns.map(col => 
                                        `<th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">${col}</th>`
                                    ).join('')}
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                `;
                
                results.forEach(product => {
                    const isInOrderList = orderList.some(item => 
                        item['Code Produit'] === product['Code Produit'] && item._source === product._source
                    );
                    
                    tableHTML += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${product._source}</td>
                            ${visibleColumns.map(col => 
                                `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${product[col] || '-'}</td>`
                            ).join('')}
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <button class="add-to-order-btn ${isInOrderList ? 'status-added text-white px-3 py-1 rounded-full text-xs' : 'text-indigo-600 hover:text-indigo-900'}" 
                                        data-source="${product._source}" 
                                        data-code="${product['Code Produit']}">
                                    ${isInOrderList ? 
                                        '<i class="fas fa-check mr-1"></i>Déjà ajouté' : 
                                        '<i class="fas fa-plus mr-1"></i>Ajouter'}
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                tableHTML += `</tbody></table></div>`;
                searchResultsContainer.innerHTML = tableHTML;
                
                // Add event listeners to "Add to order" buttons
                document.querySelectorAll('.add-to-order-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const source = e.currentTarget.dataset.source;
                        const code = e.currentTarget.dataset.code;
                        addProductToOrder(source, code);
                    });
                });
            }

            function addProductToOrder(source, code) {
                const product = currentData.find(p => p._source === source && p['Code Produit'] == code);
                if (!product) return;
                
                // Check if product is already in order list
                const existingIndex = orderList.findIndex(item => 
                    item['Code Produit'] === product['Code Produit'] && item._source === product._source
                );
                
                if (existingIndex !== -1) {
                    showNotification('Ce produit est déjà dans votre commande', 'warning');
                    return;
                }
                
                orderList.push(product);
                saveOrderToLocalStorage();
                renderOrderList();
                renderSearchResults(lastSearchResults);
                showNotification('Produit ajouté à la commande', 'success');
            }

            function renderOrderList() {
                if (orderList.length === 0) {
                    orderListContainer.innerHTML = '<p class="text-center text-gray-500 py-8 px-4">Aucun article ajouté.</p>';
                    orderCountElement.textContent = '0';
                    downloadCsvBtn.disabled = true;
                    downloadXlsxBtn.disabled = true;
                    return;
                }
                
                orderCountElement.textContent = orderList.length;
                downloadCsvBtn.disabled = false;
                downloadXlsxBtn.disabled = false;
                
                let tableHTML = `
                    <div class="custom-scrollbar" style="max-height: 400px; overflow-y: auto;">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-100 sticky top-0 z-10">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Source</th>
                                    ${visibleColumns.map(col => 
                                        `<th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">${col}</th>`
                                    ).join('')}
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-600 uppercase tracking-wider">Action</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                `;
                
                orderList.forEach((product, index) => {
                    tableHTML += `
                        <tr class="hover:bg-gray-50">
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${product._source}</td>
                            ${visibleColumns.map(col => 
                                `<td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${product[col] || '-'}</td>`
                            ).join('')}
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <button class="text-red-600 hover:text-red-900 remove-from-order" data-index="${index}">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                });
                
                tableHTML += `</tbody></table></div>`;
                orderListContainer.innerHTML = tableHTML;
                
                // Add event listeners to remove buttons
                document.querySelectorAll('.remove-from-order').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        const index = parseInt(e.currentTarget.dataset.index);
                        orderList.splice(index, 1);
                        saveOrderToLocalStorage();
                        renderOrderList();
                        renderSearchResults(lastSearchResults);
                        showNotification('Produit retiré de la commande', 'success');
                    });
                });
            }

            function populateColumnSelector() {
                columnCheckboxesContainer.innerHTML = '';
                
                allHeaders.forEach(header => {
                    const isChecked = visibleColumns.includes(header);
                    const checkboxHTML = `
                        <div class="flex items-center mb-2">
                            <input type="checkbox" id="col-${header}" value="${header}" ${isChecked ? 'checked' : ''} 
                                   class="h-4 w-4 text-indigo-600 rounded border-gray-300 focus:ring-indigo-500 column-checkbox">
                            <label for="col-${header}" class="ml-2 text-sm text-gray-700">${header}</label>
                        </div>
                    `;
                    columnCheckboxesContainer.innerHTML += checkboxHTML;
                });
                
                // Add event listeners to column checkboxes
                document.querySelectorAll('.column-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', (e) => {
                        const column = e.target.value;
                        const isChecked = e.target.checked;
                        
                        if (isChecked) {
                            if (!visibleColumns.includes(column)) {
                                visibleColumns.push(column);
                            }
                        } else {
                            const index = visibleColumns.indexOf(column);
                            if (index !== -1) {
                                visibleColumns.splice(index, 1);
                            }
                        }
                        
                        saveColumnsToLocalStorage();
                        renderSearchResults(lastSearchResults);
                        renderOrderList();
                    });
                });
            }

            function downloadOrderAsCSV() {
                if (orderList.length === 0) return;
                
                const headers = ['Source', ...visibleColumns];
                const rows = orderList.map(product => {
                    const row = [product._source];
                    visibleColumns.forEach(col => {
                        row.push(product[col] || '');
                    });
                    return row;
                });
                
                const csvContent = [headers, ...rows]
                    .map(row => row.map(cell => `"${String(cell).replace(/"/g, '""')}"`).join(','))
                    .join('\n');
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.setAttribute('href', url);
                link.setAttribute('download', `commande_mercuriale_${new Date().toISOString().slice(0,10)}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }

            function downloadOrderAsXLSX() {
                if (orderList.length === 0) return;
                
                const headers = ['Source', ...visibleColumns];
                const rows = orderList.map(product => {
                    const row = [product._source];
                    visibleColumns.forEach(col => {
                        row.push(product[col] || '');
                    });
                    return row;
                });
                
                const ws = XLSX.utils.aoa_to_sheet([headers, ...rows]);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Commande');
                XLSX.writeFile(wb, `commande_mercuriale_${new Date().toISOString().slice(0,10)}.xlsx`);
            }

            // --- UTILITY FUNCTIONS ---
            function parsePriceAsFloat(priceStr) {
                if (!priceStr) return 0;
                const cleaned = String(priceStr).replace(/[^\d,.]/g, '').replace(',', '.');
                return parseFloat(cleaned) || 0;
            }

            function formatPriceFromFloat(price) {
                return new Intl.NumberFormat('fr-FR', {
                    style: 'currency',
                    currency: 'EUR'
                }).format(price);
            }

            function showNotification(message, type = 'info') {
                // Create notification element
                const notification = document.createElement('div');
                notification.className = `fixed top-4 right-4 z-50 p-4 rounded-md shadow-md text-white max-w-sm transform transition-transform duration-300 ease-in-out ${
                    type === 'success' ? 'bg-green-500' : 
                    type === 'error' ? 'bg-red-500' : 
                    type === 'warning' ? 'bg-yellow-500' : 'bg-blue-500'
                }`;
                
                notification.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} mr-2"></i>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                // Remove notification after 3 seconds
                setTimeout(() => {
                    notification.style.transform = 'translateX(100%)';
                    setTimeout(() => {
                        if (notification.parentNode) {
                            notification.parentNode.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
            }

            function initializeModals() {
                // Settings modal
                settingsBtn.addEventListener('click', () => {
                    settingsModal.classList.remove('hidden');
                });
                
                // Contact modal
                contactBtn.addEventListener('click', () => {
                    contactModal.classList.remove('hidden');
                });
                
                // Close modals
                closeModalBtns.forEach(btn => {
                    btn.addEventListener('click', () => {
                        settingsModal.classList.add('hidden');
                        contactModal.classList.add('hidden');
                    });
                });
                
                // Reset app button
                resetAppBtn.addEventListener('click', () => {
                    if (confirm("Êtes-vous sûr de vouloir réinitialiser l'application ? Toutes vos données seront perdues.")) {
                        localStorage.clear();
                        location.reload();
                    }
                });
            }
        });
    </script>
</body>
</html>
